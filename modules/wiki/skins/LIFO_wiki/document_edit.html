<include target="header.html" />

<script>
	jQuery(document).ready(function($){
		$("#title").change(function(){			
			var alias = $("#title").val().replace(/[ ]/g, "_").toLowerCase();
			$("#alias").val(alias);
		});
		
		$("#fo_write").submit(function(event){
			event.preventDefault();
			
			var url = "index.php";
			var document_srl = {$document_srl ? $document_srl : 'null'};
			var latest_doc_edit = {$latest_doc_edit ? $latest_doc_edit : 'null'};

			$.getJSON(url
					, { act: 'procWikiCheckIfDocumentWasUpdated'
						, document_srl : document_srl
						, latest_doc_edit: latest_doc_edit} 
					, function(json){
						if(json.updated)
						{
							var confirm_message = '{$lang->confirm_document_override}';
							
							if(confirm(confirm_message))
							{
								$("#fo_write").unbind('submit').submit();
							}
						}
						else 
						{
							$("#fo_write").unbind('submit').submit();
						}
					});
			
		});
	});
</script>


<form action="./" method="post" ruleset="insert" id="fo_write" data-markup="{$module_info->markup_type}">
	<input type="hidden" name="mid" value="{$mid}" />
	<input type="hidden" name="act" value="procWikiInsertDocument" />
	<input type="hidden" name="module" value="wiki" />
	<input type="hidden" name="section" value="{$section}" />
	<input type="hidden" name="section_title" value="{$section_title}" />
    <input type="hidden" name="success_return_url" value="{getUrl('act','dispWikiContent', 'module_srl', $module_info->module_srl)}" />
	<!--@if($history)-->
	<input type="hidden" name="content" value="{htmlspecialchars($history->content)}" />
	<!--@else-->
	<input type="hidden" name="content" value="{$oDocument->getContentText()}" />
	<!--@end-->
	<input type="hidden" name="document_srl" value="{$document_srl}" />
	<input type="hidden" name="xe_validator_id" value="modules/wiki/skins/xe_wiki" />
	<div class="wkWrite" id="wikiContentContainer">
		<!--// 문서 제목 입력창  -->
		<div class="title form-group">
			<input type="text" name="title"  id="title" value="{htmlspecialchars($oDocument->get('title'))}" class="form-control" placeholder="{$lang->title}" />
		</div>

		<!--// 단축 주소 입력창 -->
		<div class="form-inline mb-2" >
			<div class="form-group">
				<label for="alias">{$lang->write_form_alias} {getFullUrl()}entry/</label>
				<input type="text" name="alias" id="alias" value="{htmlspecialchars($oDocument->get('alias'))}" class="form-control form-control-sm" readonly/>
			</div>
		</div>
		
		<!--// 에디터  -->
		<div class="editor mb-2">
			 {$oDocument->getEditor()}
		</div>

	
		<!--// 비로그인시 사용자 정보 입력창  -->
		<!--@if(!$is_logged)-->
		<div class="form-inline">
			<input type="text" name="nick_name" class="inputText form-control form-control-sm userName mb-2 mr-sm-2" placeholder="{$lang->writer}" onfocus="this.value=''" />
			<input type="password" name="password" class="inputText form-control form-control-sm userPw mb-2 mr-sm-2" placeholder="{$lang->password}" onfocus="this.value=''" />
			<input type="text" name="email_address" class="inputText form-control form-control-sm emailAddress mb-2 mr-sm-2" placeholder="{$lang->email_address}" onfocus="this.value=''" />
			<input type="text" name="homepage" class="inputText form-control form-control-sm homePage mb-2" placeholder="{$lang->homepage}" onfocus="this.value=''" />
		</div>
		<!--@end-->

		<!--// 공개 여부 설정 버튼  -->
		<!--@if(is_array($status_list))-->
			<!--@foreach($status_list AS $key=>$value)-->
			<div class="custom-control custom-radio custom-control-inline">
				<input class="custom-control-input" type="radio" name="status" value="{$key}" id="{$key}" checked="checked"|cond="($oDocument->get('status') == $key) || ($key == 'PUBLIC' && !$document_srl)"/>
				<label class="custom-control-label" for="{$key}">{$value}</label>
			</div>			
			<!--@end-->
		<!--@end-->

		<!--// 글 등록 버튼  -->
		<div class="text-right">
			<button type="submit" class="btn btn-success btn-sm"><i class="xi-message"></i> {$lang->cmd_registration}</button>			
		</div>
	</div>
</form>

</div>
</div>
<include target="footer.html" />
