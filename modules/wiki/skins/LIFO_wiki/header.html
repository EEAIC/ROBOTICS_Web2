<!--// bootstrapCDN 사용 -->
<block cond="$module_info->use_bootstrapCDN != 'N'">
    <load target="///stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"  index="-1"/>
    <load target="///cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"  index="-1"/>
    <load target="///stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"  index="-1"/>
</block>

<!--// github flavored markdown 사용-->
<block cond="$module_info->use_gfm == 'Y'">
    <load target="css/github-markdown-css/github-markdown.css"/>
</block>

<load target="css/common.css" />
<load target="/common/xeicon/xeicon.min.css" />

<load target="css/jquery.treeview.css" cond="$module_info->menu_style == 'classic'" />
<load target="js/jquery.cookie.js" />
<load target="js/jquery.treeview.js" />

<load target="css/wiki.css" index="10"/>
<load target="js/wiki.js" />
<load target="js/diff.js" cond="$use_history != 'N' && $act == 'dispWikiHistory'" />
<script>
	jQuery(document).ready(function($){
		$(".message.info").delay(1500).fadeOut('slow');
    });
</script>

<!--// Wiki 단축키 기능 -->
<load target="js/hotkeys.min.js" />
<script>
    hotkeys('n,f,m,e', function(event,handler) {
        switch(handler.key){          
            case "n":
                location.href = current_url.setQuery('act', 'dispWikiEditPage').setQuery('entry', '').setQuery('document_srl', '').setQuery('mid', current_mid);break;
            case "f":
                location.href = current_url.setQuery('act', 'dispWikiContent').setQuery('entry', '').setQuery('document_srl', '');break; 
            case "e":
                if ('{$entry}') location.href= current_url.setQuery('act', 'dispWikiEditPage').setQuery('entry', '{$entry}').setQuery('document_srl', '');
                break;   
        }
    });
</script>

<load target="///uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.js"/>
<load target="///uicdn.toast.com/tui-tree/latest/tui-tree.js"/>
<load target="///uicdn.toast.com/tui-tree/latest/tui-tree.css"/>

<!-- // 위키 초기 메뉴바 색상 지정 -->
{@ $module_info->nav_bgcolor = $module_info->nav_bgcolor ? $module_info->nav_bgcolor  : '#008275'}

<!--// 사용자 입력 헤더  -->
{$module_info->header_text}

<div class="wiki">
    <div class="">
    <div class="wkTitle">
        <nav class="navbar navbar-expand-lg navbar-dark mb-2" style="background-color: {$module_info->nav_bgcolor};">
            <block cond="$module_info->main_title">
                <a id="test" class="navbar-brand" href="{getUrl('','mid',$mid,'listStyle',$listStyle)}"  title="{$module_info->comment}">
                    <!--// wiki logo 사용-->
                    <block cond="$module_info->wiki_logo">
                        <img src="{$module_info->wiki_logo}" width="30" height="30" class="d-inline-block align-top" alt="main_logo">
                    </block>
                    {$module_info->main_title}</a>
            </block>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#wikiNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="wikiNav">
                <span class="navbar-nav mr-auto">
                    <a class="nav-item nav-link" href="{getUrl('act','dispWikiContent','entry','','document_srl','')}">{$lang->home_page}</a>
                    <a class="nav-item nav-link" href="{getUrl('act','dispWikiTitleIndex','entry','','document_srl','')}">{$lang->cmd_view_document_list}</a>
                    <a class="nav-item nav-link" href="{getUrl('act','dispWikiTreeIndex','entry','','document_srl','')}">{$lang->cmd_view_document_tree}</a>
                    <a class="nav-item nav-link" href="{getUrl('','act','dispWikiEditPage','entry','','document_srl','','mid',$mid,'vid',$vid)}">{$lang->new_document}</a>
                </span>
                <form action="{getUrl()}" method="get" class="wkSearch form-inline" no-error-return-url="true">
                    <input type="hidden" name="mid" value="{$mid}" />
                    <input type="hidden" name="vid" value="{$vid}" />                   
                    <input type="hidden" name="act" value="dispWikiContent" />
                    <input type="text" class="form-control mr-sm-2" name="entry" id="wkMove"/>
                    <div class="btn-group col col-sm-auto px-0" role="group">
                        <input class="btn btn-outline-light mt-2 my-sm-0 w-100" type="submit" value="{$lang->cmd_move}" />
                        <div class="btn-group" role="group" cond="$module_info->show_user != 'N'">
                            <button id="btnGroupDrop1" type="button" class="btn btn-outline-light mt-2 my-sm-0 dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="xi-user"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1">
                                <block cond="$is_logged">
                                    <a href="{getUrl('act','dispMemberInfo')}" class="dropdown-item">{$lang->cmd_view_member_info}</a>
                                    <div class="dropdown-divider"></div>
                                    <a href="{getUrl('act','dispMemberLogout')}" class="dropdown-item">{$lang->cmd_logout}</a>
                                </block>
                                <block cond="!$is_logged">
                                    <a class="dropdown-item disabled text-right font-weight-bold">{getenv('REMOTE_ADDR')}</a>
                                    <div class="dropdown-divider"></div> 
                                    <a class="dropdown-item" href="{getUrl('act','dispMemberLoginForm')}">{$lang->cmd_login}</a>
                                    <a class="dropdown-item" href="{getUrl('act','dispMemberSignUpForm')}">{$lang->cmd_signup}</a>
                                </block>
                            </div>
                        </div>
                        <a class="btn btn-outline-light mt-2 my-sm-0 w-100" cond="$grant->manager" href="{getUrl('act','dispWikiAdminInsertWiki')}">{$lang->cmd_setup}</a>
                    </div>
                </form>
            </div>
        </nav>
    </div>
                         
                
    <div class="area p-2">
        <div cond="$XE_VALIDATOR_MESSAGE && $XE_VALIDATOR_ID == 'modules/wiki/skins/xe_wiki'" 
        class="message {$XE_VALIDATOR_MESSAGE_TYPE} mb-2 alert alert-danger"|cond="$XE_VALIDATOR_MESSAGE_TYPE=='error'" 
        class="message {$XE_VALIDATOR_MESSAGE_TYPE} mb-2 alert alert-info"|cond="$XE_VALIDATOR_MESSAGE_TYPE =='info'"
        class="message {$XE_VALIDATOR_MESSAGE_TYPE} mb-2 alert alert-success"|cond="$XE_VALIDATOR_MESSAGE_TYPE !='error' && $XE_VALIDATOR_MESSAGE_TYPE !='info'">
            <span>{$XE_VALIDATOR_MESSAGE}</span>
        </div>
        
        <!--// 문서가 존재할 경우  -->
        <!--@if($oDocument && $oDocument->isExists())-->
        <div class="wikiRead">
            <div class="wkReadHeader">
                <div class="titleArea">
                    <!--@if(!$history && ($oDocument->isExists()||$use_history != 'N'))-->
                    <div class="command col col-sm-auto px-0 mb-2 mb-sm-auto">
                        <span class="btn-group w-100">
                            {@
                                $oDocumentModel = getModel('document');
                                $entry = $oDocumentModel->getAlias($oDocument->get('document_srl'));
                            }
                            <a class="btn btn-outline-secondary btn-sm" href="{getUrl('', 'module', 'document', 'act', 'dispDocumentPrint', 'document_srl', $oDocument->document_srl)}" target="_blank">{$lang->cmd_print}</a>
                            <a cond="$is_logged" class="btn btn-outline-secondary btn-sm" href="#" onclick="doCallModuleAction('member','procMemberScrapDocument', {$oDocument->document_srl}); return false; ">{$lang->cmd_scrap}</a>
                            <button cond="$oDocument->isExists() && $grant->delete_document" type="button" class="btn btn-outline-secondary btn-sm" onclick="if(confirm('{$lang->confirm_delete}')) { doDeleteWiki('{$oDocument->document_srl}'); }">{$lang->cmd_delete}</button>
                            <a cond="$oDocument->isExists()&& $act!='dispWikiEditPage' && $grant->write_document" class="btn btn-outline-secondary  btn-sm" href="{getUrl('act','dispWikiEditPage','entry',$entry, 'document_srl', '')}">{$lang->cmd_edit}</a>
                            <a cond="$use_history != 'N'" href="{getUrl('act','dispWikiHistory','document_srl',$oDocument->document_srl,'history_srl','')}" class="btn btn-outline-secondary  btn-sm">{$lang->histories}</a>
                            <block cond="$logged_info->is_admin == 'Y'">
                                <div class="btn-group" role="group">
                                    <button id="Wiki_management" type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        {$lang->cmd_management}
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="Wiki_management">
                                        <a class="dropdown-item" href="#" onclick="if(!confirm('{$lang->confirm_move}')) return; var params = new Array(); params['document_srl']='{$oDocument->document_srl}'; params['mid']=current_mid;params['cur_url']=current_url; exec_xml('document', 'procDocumentAdminMoveToTrash', params); return false; ">{$lang->spammer_move_to_trash}</a>
                                        <a class="dropdown-item" href="{getUrl('', 'module', 'admin', 'act', 'dispDocumentAdminList', 'search_target', 'ipaddress', 'search_keyword', $oDocument->get('ipaddress'))}" target="_blank"> {$lang->cmd_search_by_ipaddress}</a>
                                        <a class="dropdown-item" href="#" onclick="var params = new Array(); params['ipaddress_list']='{$oDocument->get('ipaddress')}'; exec_xml('spamfilter', 'procSpamfilterAdminInsertDeniedIP', params, completeCallModuleAction); return false; ">{$lang->cmd_add_ip_to_spamfilter}</a>
                                    </div>
                                </div>
                            </block>
                            
                        </span>
                    </div>
                    <!--@else-->
                    <block cond="$history">
                            <div class="alert alert-warning">
                                {$lang->notice_old_revision}
                            </div>
                    </block>
                    <div class="command">
                        <a href="{getUrl('act','','history_srl','')}" class="btn btn-outline-secondary btn-sm">{$lang->cmd_back}</a>
                    </div>
                    <!--@end-->
        

                    <h3 class="title">
                        <a class="font-weight-bold text-reset" href="{$oDocument->getPermanentUrl()}">{$oDocument->getTitle()}</a>
                    </h3>


                    <div class="sum clearfix mb-2">
                        <span class="date float-right">
                            <block cond="$is_logged && $oDocument->get('member_srl') != $logged_info->member_srl">
                                <a cond="$is_logged && $oDocument->get('member_srl') != $logged_info->member_srl" href="#" onclick="doCallModuleAction('document','procDocumentDeclare','{$oDocument->document_srl}'); return false; "> {$lang->cmd_declare}</a> |                       
                            </block>
                            <span class="ipAddress" cond="$grant->manager || $module_info->display_ip_address!='N'">{$oDocument->getIpaddress()} | </span>                        
                            
                            <!--@if($history)-->
                            <strong>{zdate($history->regdate, 'Y.m.d')}</strong> {zdate($history->regdate, 'H:i:s')}
                            <!--@else-->
                            <strong>{$oDocument->getUpdate('Y.m.d')}</strong> {$oDocument->getUpdate('H:i:s')} 
                            <!--@end-->
                        </span>                  
                    </div>
                </div>
                

                <!--// 사이트 분류 표시 -->
                {@
                    $oWikiModel = &getModel('wiki');
                    $header_document_tree = $oWikiModel->readWikiTreeCache($module_info->module_srl);            
                    $oDocument_parent_srl = $header_document_tree[$oDocument->document_srl]->parent_srl;
                    $oDocument_parent = $header_document_tree[$oDocument_parent_srl];
                }

                <div class="card my-2" cond="$oDocument_parent_srl">                                   
                    <div class="p-1">
                        분류 : <a class="" href="{getSiteUrl($site_module_info->domain, '','mid',$mid,'document_srl',$oDocument_parent->document_srl)}">{htmlspecialchars($oDocument_parent->title)}</a>
                    </div>
                </div>

            </div>
        </div>

        <!--// 문서가 존재하지 않을 경우  -->
        <!--@elseif($oDocument) -->
        <div class="wikiRead" cond="$oDocument->get('title')">
            <div class="wkReadHeader">
                <div class="titleArea">
                    <!-- Needs to access title with get('title') instead of getTitle() because oDocument is seen as invalid when doc_srl is 0 -->
                    <h3 class="title">{$oDocument->get('title')}</h3>
                </div>
            </div>
        </div>
        <!--@end-->
